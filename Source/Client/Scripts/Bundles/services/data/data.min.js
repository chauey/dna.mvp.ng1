(function(){"use strict";function t(t,i,r,u,f,e,o,s){function d(){o.init(h);s.init(h);e.init(h);g();ut();ft();et()}function g(){k.forEach(function(n){Object.defineProperty(c,n,{configurable:!0,get:function(){var t=e.getRepo(n);return Object.defineProperty(c,n,{value:t,configurable:!1,enumerable:!0}),t}})})}function nt(){function t(){c.lookup.setLookups();o.save();l("Primed the data.")}function i(){var n=h.metadataStore;f.extendMetadata(n)}if(a)return a;var n=o.load(h);return a=n?b.when(l("Loading entities and metadata from Local Storage.")):b.all([c.lookup.getAll(),c.typeOfType.getAll()]).then(i),a.then(t)}function tt(){h.hasChanges()&&(h.rejectChanges(),w("Canceled changes.",null,!0))}function it(n){function t(){o.save();w("Saved data.",null,!0)}function i(n){if(n.status!=401){var t=r.appErrorPrefix+"Save failed: "+breeze.saveErrorMessageService.getErrorMessage(n)+"<br/>";n.message=t;p(t,n);throw n;}}if(n!=""){var u=new breeze.SaveOptions({resourceName:n});return h.saveChanges(null,u).then(t).catch(i)}return h.saveChanges().then(t).catch(i)}function rt(n){return n.entityAspect.setDeleted()}function ut(){h.hasChangesChanged.subscribe(function(n){var t={hasChanges:n.hasChanges};i.$broadcast(y.hasChangesChanged,t)})}function ft(){h.entityChanged.subscribe(function(n){n.entityAction===breeze.EntityAction.PropertyChange&&i.$broadcast(y.entitiesChanged,n)})}function et(){t.$on(r.events.storage.storeChanged,function(n,t){l("Updated local storage.",t,!0)});t.$on(r.events.storage.wipChanged,function(n,t){l("Updated WIP.",t,!0)});t.$on(r.events.storage.error,function(n,t){p("Error with local storage. "+t.activity,t,!0)})}var ot=f.entityNames,y=r.events,v=i.logger.getLogFn,l=v(n),p=v(n,"error"),w=v(n,"success"),h=u.newManager(),a,k=["typeOfType","lookup","validation","admin","attachment","allDataType","user","accessControlListItem","aspNetRole","aspNetUser","aspNetUserRole","auditLog","domainObject","eLMAH_Error","permission","customer"],b=i.$q,c={prime:nt,cancel:tt,save:it,markDeleted:rt,zStorage:o,zStorageWip:s};return d(),c}var n="datacontext";angular.module("app.services.data").factory(n,["$rootScope","common","config","entityManagerFactory","model","repositories","zStorage","zStorageWip",t])})(),function(){"use strict";function n(n,t,i){function e(){n.NamingConvention.camelCase.setAsDefault()}function o(){var t=new n.MetadataStore;return i.configureMetadataStore(t),t}function s(){return new n.EntityManager({serviceName:r,metadataStore:u})}new n.ValidationOptions({validateOnAttach:!1,validateOnPropertyChange:!1}).setAsDefault();e();var f=window.location.protocol+"//"+window.location.host+"/",r=t.remoteServiceName,u=o();return{metadataStore:u,newManager:s,serviceRoot:f,serviceName:r}}angular.module("app.services.data").factory("entityManagerFactory",["breeze","config","model",n])}(),function(){"use strict";function n(n,t){function r(){n.createAndRegister(i);t.createAndRegister(i)}function u(i){n.applyValidators(i);t.applyValidators(i)}function f(n){var t=breeze.EntityState.Unchanged}var i={typeOfType:"TypeOfType",validation:"Validation",account:"AspNetUser",audit:"AuditLog",error:"ELMAH_Error",attachment:"Attachment",allDataType:"AllDataType",user:"User",accessControlListItem:"AccessControlListItem",aspNetRole:"AspNetRole",aspNetUserRole:"AspNetUserRole",aspNetUser:"AspNetUser",domainObject:"DomainObject",permission:"Permission",customer:"Customer",customer:"Customer"};return{configureMetadataStore:r,entityNames:i,controllerNames:{typeOfType:"TypeOfTypes",validation:"Validations",account:"AspNetUsers",audit:"AuditLogs",error:"ELMAH_Errors",attachment:"Attachments",allDataType:"AllDataTypes",user:"Users",accessControlListItem:"AccessControlListItems",aspNetRole:"AspNetRoles",aspNetUserRole:"AspNetUserRoles",aspNetUser:"AspNetUsers",domainObject:"DomainObjects",permission:"Permissions",customer:"Customers",customer:"Customers"},createNullos:f,extendMetadata:u}}angular.module("app.services.data").factory("model",["allDataType.validation","validation.validation",n])}(),function(){"use strict";function t(t){function s(n){c(n);l(n);p(n);a(n);y(n);v(n);w(n);k(n);g(n);tt(n);rt(n);ft(n);et(n);ut(n);ht(n);at(n);pt(n)}function h(n){r=n;u=b();e=nt();f=d();o=it();i.register(u);i.register(e);i.register(f);i.register(o)}function c(n){var t=n.getEntityType(r.validation);["integer","age","creditCard"].forEach(function(n){t.getProperty(n).validators.push(i.integer())})}function l(n){var t=n.getEntityType(r.validation);["date","beforeDate","afterDate"].forEach(function(n){t.getProperty(n).validators.push(i.date())})}function a(n){var t=n.getEntityType(r.validation);t.getProperty("string").validators.push(i.string())}function v(n){var t=n.getEntityType(r.validation);t.getProperty("phone").validators.push(i.maxLength({maxLength:15}));t.getProperty("zip").validators.push(i.maxLength({maxLength:5}))}function y(n){var t=n.getEntityType(r.validation);t.getProperty("zip").validators.push(i.stringLength({minLength:5,maxLength:10}))}function p(n){var t=n.getEntityType(r.validation);t.getProperty("email").validators.push(i.emailAddress())}function w(n){var t=n.getEntityType(r.validation);t.getProperty("uRL").validators.push(i.url())}function b(){function n(n){return n?n.id!==0:!1}return new i("requireReferenceEntity",n,{messageTemplate:"Missing %displayName%",isRequired:!0})}function k(n){var t,i;i=["name","abbreviation"];t=n.getEntityType(r.typeOfType);i.forEach(function(n){t.getProperty(n).validators.push(u)})}function d(){return i.makeRegExpValidator("startsWithDNA",/DNA|dna/,"'%value%' must contains 'DNA' or 'dna'.")}function g(n){var t=n.getEntityType(r.validation);t.getProperty("startsWithDPT").validators.push(e)}function nt(){return i.makeRegExpValidator("containsDNA",/^(DNA|dna)/,"'%value%' must starts with 'DNA' or 'dna'.")}function tt(n){var t=n.getEntityType(r.validation);t.getProperty("containsDPT").validators.push(f)}function it(){return i.makeRegExpValidator("integerCustom",/^[1-9]\d*$/,"'%value%' is not a positive integer.")}function rt(n){var t=n.getEntityType(r.validation);["phone","zip"].forEach(function(n){t.getProperty(n).validators.push(o)})}function ut(n){var t=n.getEntityType(r.validation);t.getProperty("creditCard").validators.push(i.creditCard())}function ft(n){var t=n.getEntityType(r.validation);t.getProperty("phone").validators.push(i.phone())}function et(n){function t(n){return/^\d{5}([\-]\d{4})?$/.test(n)}var u=function(n){var i=n.getProperty("zip");return t(i)},f=new i("zipCodeValidator",u,{messageTemplate:"For the US, this is not a valid PostalCode"}),e=n.getEntityType(r.validation);e.getProperty("zip").validators.push(f)}function ot(n,t){return n==null?!0:n&&n.toString().length<=t.maxLength}function st(n){var t={messageTemplate:"%displayName% must be equal or less than %maxLength% characters.",maxLength:n.maxLength};return new i("stringMinMaxLength",ot,t)}function ht(n){var t=st({maxLength:16}),i=n.getEntityType(r.validation);i.getProperty("creditCard").validators.push(t)}function ct(n,t){return n==null?!0:n&&n>=t.minValue&&n<=t.maxValue}function lt(n){var t={messageTemplate:"%displayName% must be between %minValue% and %maxValue%.",minValue:n.minValue,maxValue:n.maxValue};return new i("intRange",ct,t)}function at(n){var t=lt({minValue:1,maxValue:150}),i=n.getEntityType(r.validation);i.getProperty("age").validators.push(t)}function vt(n,t){var u=t.invalidChars,r,i;if(n==null)return!0;for(i=0;i<n.toString().length;i++)if(r=n.toString().charAt(i),u.indexOf(r)!=-1)return!1;return!0}function yt(n){var t={messageTemplate:"%displayName% cannot contains '%invalidChars%'",invalidChars:n.invalidChars};return new i("specialCharacters",vt,t)}function pt(n){var t=yt({invalidChars:"-"}),i=n.getEntityType(r.validation);i.getProperty("creditCard").validators.push(t)}var r,wt=t.logger.getLogFn(n),i=breeze.Validator,u,f,e,o;return{applyValidators:s,createAndRegister:h}}var n="model.validation";angular.module("app.services.data").factory(n,["common",t])}();